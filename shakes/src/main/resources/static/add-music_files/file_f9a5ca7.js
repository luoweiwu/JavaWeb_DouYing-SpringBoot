define("web:page/musician/apply/utils/file",function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function r(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var a=arguments[n];if(null!=a)for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},writable:!0,configurable:!0});var o=function(){function e(t){n(this,e),this.file=t}return r(e,[{key:"isFunc",value:function(e){return"function"==typeof e}},{key:"convertBase64UrlToBlob",value:function(e){for(var t=window.atob(e.split(",")[1]),n=new ArrayBuffer(t.length),a=new Uint8Array(n),r=0;r<t.length;r++)a[r]=t.charCodeAt(r);return new Blob([n],{type:"image/png"})}},{key:"uploadProgress",value:function(e){return function(t){if(t.lengthComputable){var n=Math.floor(t.loaded/t.total*100);e(n)}}}},{key:"getImageSize",value:function(e){var t=new Image;return t.src=e,new Promise(function(e){t.onload=function(){var n=t.width,a=t.height;e({width:n,height:a})}})}},{key:"getTextData",value:function(e){return e=e||this.file,new Promise(function(t,n){var a=new FileReader;a.readAsText(e),a.onload=function(e){var n=e.target.result;t(n)},a.onerror=function(){n("文件识别错误")}})}},{key:"getUrlData",value:function(e){return e=e||this.file,new Promise(function(t,n){var a=new FileReader;a.readAsDataURL(e),a.onload=function(e){var n=e.target.result;t(n)},a.onerror=function(){n("文件识别错误")}})}},{key:"getAudioDuration",value:function(){return this.getUrlData().then(function(e){var t=new Audio;return t.src=e,window.audio=t,new Promise(function(e,n){t.addEventListener("loadeddata",function(){e(t.duration)}),t.addEventListener("error",function(){n("加载失败")})})})}},{key:"_createCanvas",value:function(){return canvas=document.createElement("canvas"),document.body.appendChild(canvas),this.canvas=canvas,canvas}},{key:"comporessImage",value:function(e){var t=e.imageInfo,n=new Image;n.src=e.urlData;var a=this.canvas||this._createCanvas(),r=e.compressSize/t.width>1?1:e.compressSize/t.width,o=a.getContext("2d"),i=t.width*r,u=t.height*r;a.width=i,a.height=u,o.fillStyle="#fff",o.fillRect(0,0,i,u),o.drawImage(n,0,0,i,u);try{return this.file=this.convertBase64UrlToBlob(a.toDataURL("image/jpeg")),this.file}catch(l){console.warn(l)}}},{key:"getFileInfo",value:function(e){e=e||this.file;var t=e.size/1024,n=e.name,a=n.split(".");return a=a[a.length-1],a=a&&a.toLocaleLowerCase(),t=t>1024?(t/1024).toFixed(2)+" MB":t.toFixed(1)+" KB",{fileName:n,size:t,type:a}}},{key:"upload",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=new FormData;t=t||this.file,n.append("file",t);for(var a in e.data)n.append&&n.append(a,e.data[a]);e.data=n,e=Object.assign(e,{method:"POST",contentType:!1,processData:!1}),this.isFunc(e.progress)&&(e.xhr=function(){var t=new window.XMLHttpRequest;return t.upload.addEventListener("progress",e.progress,!1),t}),$.ajax(e)}}]),e}();t.default=o});